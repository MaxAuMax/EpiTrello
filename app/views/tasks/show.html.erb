<turbo-frame id="task_details">
  <div class="task-details-content">
    <!-- Title Section with Status -->
    <div class="task-header-section">
      <h2 class="task-title-main"><%= @task.title %></h2>
      <span class="task-status-badge" style="background: <%= case @task.task_status&.name
        when 'Backlog' then 'var(--color-slate-100)'
        when 'To Do' then 'rgba(59, 130, 246, 0.1)'
        when 'In Progress' then 'rgba(251, 146, 60, 0.1)'
        when 'Completed' then 'rgba(34, 197, 94, 0.1)'
        when 'On Hold' then 'rgba(239, 68, 68, 0.1)'
        else 'var(--color-slate-100)'
      end %>; color: <%= case @task.task_status&.name
        when 'Backlog' then 'var(--color-slate-600)'
        when 'To Do' then 'var(--color-blue-500)'
        when 'In Progress' then 'var(--color-orange-600)'
        when 'Completed' then 'var(--color-green-600)'
        when 'On Hold' then 'var(--color-red-600)'
        else 'var(--color-slate-600)'
      end %>;">
        <%= @task.task_status&.name || "No status" %>
      </span>
    </div>

    <!-- Divider -->
    <div class="task-divider"></div>

    <!-- Meta Information Grid -->
    <div class="task-meta-grid">
      <!-- Due Date -->
      <div class="task-modal-meta-item">
        <span class="task-detail-label">
          <svg style="width: 14px; height: 14px; margin-right: 4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          Due Date
        </span>
        <div class="task-meta-value <%= 'task-meta-empty' unless @task.due_date.present? %>">
          <%= @task.due_date.present? ? @task.due_date.strftime("%b %d, %Y") : "Not set" %>
        </div>
      </div>

      <!-- Assignee -->
      <div class="task-modal-meta-item">
        <span class="task-detail-label">
          <svg style="width: 14px; height: 14px; margin-right: 4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Assigned to
        </span>
        <% if @task.assignee.present? %>
          <div class="task-assignee-compact">
            <div class="task-assignee-avatar-small">
              <%= @task.assignee.username.first.upcase %>
            </div>
            <span class="task-meta-value"><%= @task.assignee.username %></span>
          </div>
        <% else %>
          <div class="task-meta-value task-meta-empty">Not assigned</div>
        <% end %>
      </div>
    </div>

    <!-- Description -->
    <div class="task-description-section">
      <span class="task-detail-label">
        <svg style="width: 14px; height: 14px; margin-right: 4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Description
      </span>
      <p class="task-detail-text <%= 'task-meta-empty' unless @task.description.present? %>">
        <%= @task.description.present? ? @task.description : "No description" %>
      </p>
    </div>

    <%# Comments Section %>

    <div class="task-comments-section">
      <span class="task-detail-label">
        <svg style="width: 14px; height: 14px; margin-right: 4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
        </svg>
        Comments
      </span>
      <% unless @comments.empty? %>
          <div class="task-comments-list">
            <% @comments.each do |comment| %>
              <div class="task-comment-item">
                <div class="task-comment-header">
                  <div class="task-assignee-avatar-small">
                    <%= comment.user.username.first.upcase %>
                  </div>
                  <div class="task-comment-user-info">
                    <span class="task-comment-username"><%= comment.user.username %></span>
                    <span class="task-comment-timestamp"><%= time_ago_in_words(comment.created_at) %> ago</span>
                  </div>
                </div>
                <div class="task-comment-content">
                  <p class="task-comment-text"><%= comment.content %></p>
                </div>
              </div>
            <% end %>
          </div>
      <% end %>

      <div class="task-add-comment-form">
        <%= form_with(model: [@project, @task, Comment.new], local: true, html: { class: 'add-comment-form' }) do |form| %>
          <%= form.text_area :content, placeholder: "Add a comment...", rows: 2, class: "form-control form-control-sm" %>
          <br>
          <%= form.submit "Comment", class: "btn btn-primary btn-sm mt-1" %>
        <% end %>
      </div>
    </div>

    <!-- Actions -->
    <div class="task-modal-actions">
      <%= link_to edit_project_task_path(@project, @task), class: 'btn btn-secondary btn-sm', data: { action: 'click->modal#navigate' } do %>
        <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Edit
      <% end %>
      <%= link_to delete_project_task_path(@task.project, @task), 
          class: 'btn btn-secondary btn-sm task-delete-btn',
          data: { action: 'click->modal#navigate' } do %>
        <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
        Delete
      <% end %>
    </div>
  </div>
</turbo-frame>
