<%= button_to "Logout", destroy_user_session_path, method: :delete, class: "logout-button" %>

<div class="user-dashboard">
  <div class="dashboard-header">
    <h1>Welcome, <%= @user.username %> ðŸ‘‹</h1>
    <% if @user.active_team.present? %>
      <p class="team-info-simple">
        <strong><%= @user.active_team.name %></strong> â€¢ <%= @user.active_team.team_users.accepted.count %> members
        <%= link_to "View Team", team_path(@user.active_team), class: "btn btn-primary", style: "margin-left: var(--spacing-md);" %>
      </p>
    <% elsif @user.pending_team_invitations.any? %>
      <div class="pending-invitations" style="margin-top: var(--spacing-lg);">
        <p>You have <%= @user.pending_team_invitations.count %> pending invitation(s):</p>
        <% @user.pending_team_invitations.each do |invitation| %>
          <div class="invitation-card">
            <p><%= invitation.team.name %> (from <%= invitation.team.owner.username %>)</p>
            <%= button_to "Accept", accept_team_team_user_path(invitation.team, invitation), method: :patch, class: "btn btn-success" %>
            <%= button_to "Reject", reject_team_team_user_path(invitation.team, invitation), method: :patch, class: "btn btn-danger" %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p style="margin-top: var(--spacing-md); color: var(--color-slate-600);">
        You are not in any team. 
        <%= link_to "Create a Team", new_team_path, class: "btn btn-primary", style: "margin-left: var(--spacing-sm);" %>
      </p>
    <% end %>
  </div>

  <!-- Team Projects Section -->
  <% if @user.active_team.present? %>
    <div class="projects-section">
      <h2>Team Projects</h2>
      <ul class="projects-list">
        <% @user.active_team.projects.order(:name).each do |project| %>
          <li class="project-card">
            <h3><%= project&.name %></h3>
            <p><span>Description:</span> <%= project.description.present? ? project.description : "<em>No description provided</em>".html_safe %></p>
            <p><span>Status:</span> <%= project&.project_status&.name %></p>
            <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
              <%= link_to "View Project", project_path(project), class: "btn" %>
              <%= link_to "Edit", edit_project_path(project), class: "btn btn-secondary" %>
            </div>
          </li>
        <% end %>
        
        <% if @user.active_team.owner_id == @user.id && @user.active_team.projects.count < 3 %>
          <%= link_to new_project_path(team_id: @user.active_team.id), class: "project-card-link" do %>
            <li class="project-card project-card-empty">
              <span class="empty-plus">+</span>
              <span>New team project</span>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Personal Projects Section -->
  <div class="projects-section">
    <h2>My Personal Projects</h2>
    <ul class="projects-list">
      <% @user.projects.personal.distinct.order(:name).each do |project| %>
        <li class="project-card">
          <h3><%= project&.name %></h3>
          <p><span>Description:</span> <%= project.description.present? ? project.description : "<em>No description provided</em>".html_safe %></p>
          <p><span>Status:</span> <%= project&.project_status&.name %></p>
          <% if project.owner_id != @user.id %>
            <p style="font-size: 0.875rem; color: var(--color-slate-600); margin-top: var(--spacing-xs);">
              <em>Owned by <%= project.owner.username %></em>
            </p>
          <% end %>
          <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
            <%= link_to "View Project", project_path(project), class: "btn" %>
            <% if project.owner_id == @user.id %>
              <%= link_to "Edit", edit_project_path(project), class: "btn btn-secondary" %>
            <% end %>
          </div>
        </li>
      <% end %>
      
      <%= link_to new_project_path, class: "project-card-link" do %>
        <li class="project-card project-card-empty">
          <span class="empty-plus">+</span>
          <span>New personal project</span>
        </li>
      <% end %>
    </ul>
  </div>
</div>
